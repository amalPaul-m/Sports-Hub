{{#section 'styles'}}
<link rel="stylesheet" href="/stylesheets/orderslist.css">
{{/section}}



<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="px-4 mb-3">
    <img src="/images/Logo-dark.png" alt="logo" height="50">
  </div>

  <h6 class="px-3">Dashboard</h6>
  <a class="nav-link" href="/dashboard"><i class="bi bi-house-door"></i> Dashboard</a>
  <a class="nav-link active" href="#"><i class="bi bi-file-earmark"></i> Order List</a>
  <a class="nav-link" href="/products"><i class="bi bi-inboxes"></i> All Products</a>
  <a class="nav-link" href="/salesreport"><i class="bi bi-file-earmark-bar-graph"></i> Sales Report</a>
  <a class="nav-link" href="/customers"><i class="bi bi-people"></i> Customers</a>
  <a class="nav-link" href="/coupon"><i class="bi bi-ticket-detailed"></i> Coupon</a>
  <a class="nav-link" href="/offers"><i class="bi bi-funnel"></i> Offers</a>
  <a class="nav-link" href="/category"><i class="bi bi-grid"></i> Category</a>
  {{!-- <a class="nav-link" href="#"><i class="bi bi-arrow-counterclockwise"></i> Refund/Return</a>
  <a class="nav-link" href="#"><i class="bi bi-tv"></i> Banners</a> --}}
</div>

<!-- Topbar -->
<div class="topbar border-bottom fixed-top" id="topbar">
  <button class="btn text-white" onclick="toggleSidebar()"><i class="bi bi-list fs-4 text-dark"></i></button>
  <div class="d-flex align-items-center gap-3">
    <form role="search" action="" method="get" class="d-flex gap-2">
          <input type="text" class="form-control form-control-sm shadow-none" placeholder="Search..." style="width: 200px;"
            name="q" value="{{query}}" required>
          <button class="btn btn-outline-secondary btn-sm " type="submit">Search</button>
    </form>
    <i class="bi bi-bell-fill fs-5 text-dark"></i>

    <!-- Large button groups (default and split) -->
    <div class="btn-group">
      <button class="btn btn-outline-dark btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">
        ADMIN
      </button>
      <ul class="dropdown-menu p-3">
        <li><b>Admin</b></li>
        <li class="pt-2"><a href="#" class="text-decoration-none text-dark">Change Password</a></li>
        <form class="d-flex" role="search" action="/logout/admin">
          <li class="pt-2"><button type="submit" class="text-decoration-none text-dark btn btn-white ">Logout <i
                class="bi bi-box-arrow-right float-end ps-4"></i></button></li>
        </form>
      </ul>
    </div>
  </div>
</div>


<!-- Main Content -->



<div class="main-content" id="main">

  <div class="container mt-5">
    <h4><b>Order List</b></h4>

    <!-- breadcrumb -->

    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard" class="text-decoration-none text-secondary">Dashboard</a></li>
        <li class="breadcrumb-item active text-dark" aria-current="page">Order List</li>
      </ol>
    </nav>


    <div class="d-flex align-items-center mb-3">
      <a href="/orderslist" class="tab-link text-decoration-none active" >Active Orders</a>
      <a href="/orderslist/ordersreturnlist" class="tab-link text-decoration-none ">Return Orders</a>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3 mt-0 flex-wrap">
      <div>

      </div>
      <div>
        <a class="btn btn-outline-dark m-1" href="/orderslist" type="button"><i class="bi bi-arrow-clockwise"></i></a>
        {{!-- <button class="btn btn-outline-secondary me-2">Filters <i class="bi bi-funnel"></i></button> --}}
        {{!-- <button class="btn btn-outline-dark">Export <i class="bi bi-download"></i></button> --}}
      </div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Sl.No <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
            <th>Order ID <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
            <th>Date <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
            <th>Payment<a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></i></th>
            <th>Amount <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
            <th>Status <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
            <th>Action <a href="" class="text-dark ms-1"><i class="bi bi-arrow-down-up"></i></a></th>
          </tr>
        </thead>
        <tbody>
         
          <!-- Example Rows -->
          {{#each orders}}
          <tr>
            <td>{{addOne @index}}</td>
            <td><a href="" class="text-decoration-none" data-bs-toggle="modal" 
            data-bs-target="#staticBackdrop{{this._id}}">{{this.orderId}}</a></td>
            <td>{{formatDateFull this.createdAt}}</td>
            {{#each this.paymentInfo}}
            <td>{{this.paymentMethod}}</td>
            <td>{{this.totalAmount}}.00</td>
            {{/each}}
            <td><span class="{{this.deliveryStatus}}">
              {{this.deliveryStatus}}</span></td>
            <td>

                <div class="dropdown">
                <button class="btn btn-outline-dark dropdown-toggle btn-sm {{this.deliveryStatus}}-but" data-bs-toggle="dropdown">Change Status</button>
                <ul class="dropdown-menu">

                    <li><button type="button" class="dropdown-item status-btn" data-bs-toggle="modal" 
                    data-bs-target="#unBlockModal1{{this._id}}" class="unblock" id="btn-1">Mark as Shipped</button></li>
                    
                    <li><button type="button" class="dropdown-item status-btn" data-bs-toggle="modal" 
                    data-bs-target="#unBlockModal2{{this._id}}" class="unblock" id="btn-2">Out Of Delivery</button></li>

                    <li><button type="button" class="dropdown-item status-btn" data-bs-toggle="modal" 
                    data-bs-target="#unBlockModal3{{this._id}}" class="unblock" id="btn-3">Delivered</button></li>

                    <li><button type="button" class="dropdown-item status-btn" data-bs-toggle="modal" 
                    data-bs-target="#unBlockModal4{{this._id}}" class="unblock" id="btn-4">Cancelled</button></li>

                </ul>
                </div>
            </td>
          </tr>

          <!-- product details -->
          <div class="modal fade modal-lg" id="staticBackdrop{{this._id}}" tabindex="-1" aria-labelledby="addressModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5>Order ID: <strong>#{{this.orderId}}</strong></h5>
          
                          <div class="dropdown ms-3">
                          <button class="btn btn-outline-dark dropdown-toggle btn-sm" data-bs-toggle="dropdown">Change Status</button>
                          <ul class="dropdown-menu">

                              <li><a class="dropdown-item" href="" data-bs-toggle="modal" 
                              data-bs-target="#unBlockModal1{{this._id}}" class="unblock">Mark as Shipped</a></li>
                              
                              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" 
                              data-bs-target="#unBlockModal2{{this._id}}" class="unblock">Out Of Delivery</a></li>

                              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" 
                              data-bs-target="#unBlockModal3{{this._id}}" class="unblock">Delivered</a></li>

                              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" 
                              data-bs-target="#unBlockModal4{{this._id}}" class="unblock">Cancelled</a></li>

                          </ul>
                          </div>
          
                          <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <div class="container mt-3">
                              <div class="order-box bg-white mb-4">

                                  {{#each this.productInfo}}
                                  {{#or (eq this.status "confirmed") (eq this.status "returned")}}
                                  {{!-- {{#if (eq this.status "confirmed")}} --}}
                                  <div class="row bordrer-card">
                                      <div class="col col-md-2">
                                          <img src="/images/products/{{firstImage this.productId.imageUrl}}" class="img-fluid" alt="Product Image">
                                      </div>
                                      <div class="col col-md-8">
                                          <div>
                                              <h6 class="mb-1">{{this.productId.productName}}
                                                  <span class="badge bg-black">{{../deliveryStatus}}</span></h6>
                                              </h6>
          
                                              <p class="mb-1 text-muted">Color: <button class="btn" style="background-color: {{this.color}};"></button>
                                                <br>Size: {{this.size}} {{this.productId.unitSize}}
                                                <br>Quantity: {{this.quantity}}</p>
                                              <p class="text-muted mb-0" style="font-size: 0.85rem;">
                                                  Product ID: {{last8 this._id}}<br>
                                                  User ID: {{last8 ../this.userId}}
                                              </p>
                                          </div>
                                      </div>
                                      <div class="col col-md-2 mt-5">
                                          <h5 class="fw-bold">₹{{this.productId.salePrice}}.00</h5>
                                          {{#unless (eq this.status "cancelled")}}
                                          <a href="/invoice/download-invoice/{{../orderId}}" class="btn btn-outline-dark mt-1">INVOICE</a>
                                          {{/unless}}
                                      </div>
                                  </div>
                                  {{/or}}
                                  {{/each}}


                              </div>
          
                              <div class="mb-4 mt-5">
                                  <h6 class="mb-2 fw-bold">Address</h6>
                                  <span class="fw-semibold">{{this.addressId.fullName}}</span>
                                  <p class="mb-1">{{this.addressId.houseNo}}, {{this.addressId.street}}
                                    <br>{{this.addressId.district}}, {{this.addressId.state}} <br>
                                    {{this.addressId.pinCode}} </p>
                                  <span class="status-badge">{{this.addressId.addressType}}</span><br>
                              </div>
          
                              <div class="mb-4">
                                  <h6 class="mb-2 fw-bold">Payment Type</h6>
                                  {{#each this.paymentInfo}}
                                  <p>{{this.paymentMethod}}</p>
                                  {{/each}}
                              </div>
                                  {{#each this.paymentInfo}}
                              <div class="mb-4">
                                  <div class="d-flex justify-content-between">
                                      <span class="info-label">Net Amount</span>
                                      <span>₹{{netAmount (add this.totalAmount ../couponInfo.[0].discount)}}</span>
                                  </div>
                                  <div class="d-flex justify-content-between">
                                      <span class="info-label">GST</span>
                                      <span>₹{{gst (add this.totalAmount ../couponInfo.[0].discount)}}</span>
                                  </div>
                                  <div class="d-flex justify-content-between">
                                      <span class="info-label">Shipping & Handling Fee</span>
                                      <span>₹0.00</span>
                                  </div>
                                  <div class="d-flex justify-content-between mt-4">
                                      <span class="fw-bold fs-5">Total Amount</span>
                                      <span class="fw-bold fs-5">₹{{add this.totalAmount ../couponInfo.[0].discount}}</span>
                                  </div>
                              </div>

                              <div class="d-flex justify-content-between">
                                  <span class="info-label">Discount Amount</span>
                                  <span>- ₹{{../couponInfo.[0].discount}}.00</span>
                              </div>
          
                              <div class="d-flex justify-content-between border-top pt-3">
                                  <h5 class="fw-bold">Payable Amount</h5>
                                  <h5 class="fw-bold">₹{{this.totalAmount}}.00</h5>
                                  {{/each}}
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>



          {{!-- poup window mark as shipped --}}

          <div class="modal fade bg-setting" id="unBlockModal1{{this._id}}" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog float-end me-5">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Status </h1>
                  <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to change status to shipped ?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>

                  <form action="/orderslist/shipped/{{this._id}}?_method=PATCH" method="POST">
                    <input type="hidden" name="_method" value="PATCH" />
                    <button type="submit" class="btn btn-outline-success">Save</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          
          {{!-- poup window mark as out of delivery --}}

          <div class="modal fade bg-setting" id="unBlockModal2{{this._id}}" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog float-end me-5">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Status </h1>
                  <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to change status to out of delivery ?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>

                  <form action="/orderslist/outofdelivery/{{this._id}}?_method=PATCH" method="POST">
                    <input type="hidden" name="_method" value="PATCH" />
                    <button type="submit" class="btn btn-outline-success">Save</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          {{!-- poup window mark as delivered --}}

          <div class="modal fade bg-setting" id="unBlockModal3{{this._id}}" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog float-end me-5">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Status </h1>
                  <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to change status to delivered ?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>

                  <form action="/orderslist/delivered/{{this._id}}?_method=PATCH" method="POST">
                    <input type="hidden" name="_method" value="PATCH" />
                    <button type="submit" class="btn btn-outline-success">Save</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          {{!-- poup window mark as cancelled --}}

          <div class="modal fade bg-setting" id="unBlockModal4{{this._id}}" tabindex="-1"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog float-end me-5">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Status </h1>
                  <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to change status to Cancelled ?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>

                  <form action="/orderslist/cancelled/{{this._id}}?_method=PATCH" method="POST">
                    <input type="hidden" name="_method" value="PATCH" />
                    <button type="submit" class="btn btn-outline-success">Save</button>
                  </form>
                </div>
              </div>
            </div>
          </div>


          {{/each}}


          


        </tbody>
      </table>
    </div>

    

    <!-- Pagination -->
    <div class="mt-3 mb-4 pagination-pro">
      <nav aria-label="Page navigation example">
        <ul class="pagination">
          {{#if (gt currentPage 1)}}
          <li class="page-item">
            <a class="page-link pagination-border shadow-none" href="/orderslist?page={{subtract currentPage 1}}"
              aria-label="Previous">
              <span aria-hidden="true" class="text-black">&lang;</span>
            </a>
          </li>
          {{/if}}
          {{#each (pagination totalPages)}}
          <li class="page-item ms-2 {{#if (eq this ../currentPage)}}active{{/if}}">
            <a class="page-link pagination-number" href="/orderslist?page={{this}}">{{this}}</a>
          </li>
          {{/each}}

          {{#if (lt currentPage totalPages)}}
          <li class="page-item ms-2">
            <a class="page-link pagination-border shadow-none" href="/orderslist?page={{add currentPage 1}}"
              aria-label="Next">
              <span aria-hidden="true" class="text-black">&rang;</span>
            </a>
          </li>
          {{/if}}
        </ul>
      </nav>
    </div>
  </div>
</div>



{{#section 'scripts'}}
<script src="/javascripts/orderslist.js"></script>
{{/section}}

